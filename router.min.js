/*
 Router.js
 v 0.6.3
 author: Fabrizio Ruggeri
 website: http://ramielcreations.com/projects/router-js/
 @license GPL-v2
*/
(function(g,r){function n(){for(var a=1;a<arguments.length;a++)for(var b in arguments[a])arguments[a].hasOwnProperty(b)&&(arguments[0][b]=arguments[a][b]);return arguments[0]}Function.prototype.bind||(Function.prototype.bind=function(a){var b=this,e=Array.prototype.slice.call(arguments);a=e.shift();return function(){return b.apply(a,e.concat(Array.prototype.slice.call(arguments)))}});var m=/:([\w\d]+)/g,p=/\/\*(?!\*)/,q=/\*{2}/,l=/\/*$/,c=function(a){this._options=n({ignorecase:!0},a);this._routes=
[];this._befores=[];this._errors={_:function(a,e,d){console&&console.warn&&console.warn("Router.js : "+d)},_404:function(a,e){console&&console.warn&&console.warn("404! Unmatched route for url "+e)},_500:function(a,e){if(console&&console.error)console.error("500! Internal error route for url "+e);else throw Error("500");}};this._paused=!1;g.onhashchange=function(a){this._paused||this._route(this._extractFragment(g.location.href));return!0}.bind(this)};c.prototype._extractFragment=function(a){var b=
a.indexOf("#");return 0<=b?a.substring(b):"#/"};c.prototype._throwsRouteError=function(a,b,e){if(this._errors["_"+a]instanceof Function)this._errors["_"+a](b,e,a);else this._errors._(b,e,a);return!1};c.prototype._buildRequestObject=function(a,b,e){if(!a)throw Error("Unable to compile request object");var d={};d.href=a;b&&(d.params=b);b=a.split("?");if(2==b.length){a=null;b=b[1].split("&");d.query={};for(var c=0,f=b.length;c<f;c++)a=b[c].split("="),d.query[decodeURI(a[0])]=decodeURI(a[1]);d.queryString=
d.query}e&&0<e.length&&(d.splats=e);return d};c.prototype._followRoute=function(a,b,e){var d=e.splice(0,1),d=this._routes[d],c=b.match(d.path),f={},f={},h=[];if(!d)return this._throwsRouteError(500,Error("Internal error"),a);for(var k=0,g=d.paramNames.length;k<g;k++)f[d.paramNames[k]]=c[k+1];k+=1;if(c&&k<c.length)for(;k<c.length;k++)h.push(c[k]);b=0==e.length?null:function(b,e,d,c){return function(c,f){if(c)return this._throwsRouteError(f||500,c,a);this._followRoute(b,e,d)}.bind(this)}.call(this,
a,b,e);f=this._buildRequestObject(a,f,h);d.routeAction(f,b)};c.prototype._routeBefores=function(a,b,e,c,g){var f;if(0<a.length){var h=a.splice(0,1),h=h[0];f=function(b,f){if(b)return this._throwsRouteError(f||500,b,e);this._routeBefores(a,h,e,c,g)}.bind(this)}else f=function(a,b){if(a)return this._throwsRouteError(b||500,a,e);this._followRoute(e,c,g)}.bind(this);b(this._buildRequestObject(e),f)};c.prototype._route=function(a){var b="",c=this._befores.slice(),d=[],g,f=a;if(0==f.length)return!0;f=f.replace(l,
"");g=f.split("?")[0].replace(l,"");for(var h in this._routes)this._routes.hasOwnProperty(h)&&(b=this._routes[h],b.path.test(g)&&d.push(h));if(0<d.length)0<c.length?(b=c.splice(0,1),b=b[0],this._routeBefores(c,b,a,f,d)):this._followRoute(a,f,d);else return this._throwsRouteError(404,null,a)};c.prototype.pause=function(){this._paused=!0};c.prototype.play=function(a){this._paused=!1;("undefined"==typeof a?0:a)&&this._route(this._extractFragment(g.location.href))};c.prototype.setLocation=function(a){g.history.pushState(null,
"",a)};c.prototype.redirect=function(a){this.setLocation(a);this._paused||this._route(this._extractFragment(a))};c.prototype.addRoute=c.prototype.add=c.prototype.route=c.prototype.get=function(a,b){var c,d=this._options.ignorecase?"i":"",g=[];if("string"==typeof a){for(a=a.replace(l,"");null!=(c=m.exec(a));)g.push(c[1]);a=RegExp(a.replace(m,"([^/\\?]+)").replace(p,"/([^/]+)").replace(q,"(.*)")+"(?:\\?.+)?$",d)}this._routes.push({path:a,paramNames:g,routeAction:b});return this};c.prototype.before=
function(a){this._befores.push(a);return this};c.prototype.errors=function(a,b){if(isNaN(a))throw Error("Invalid code for routes error handling");if(!(b instanceof Function))throw Error("Invalid callback for routes error handling");this._errors["_"+a]=b;return this};c.prototype.run=function(a){a||(a=this._extractFragment(g.location.href));a=0==a.indexOf("#")?a:"#"+a;this.redirect(a)};g.Router=c})(window);
