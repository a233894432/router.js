/*
 Router.js
 v 0.6.1
 author: Fabrizio Ruggeri
 website: http://ramielcreations.com/projects/router-js/
 @license GPL-v2
*/
(function(g,q){Function.prototype.bind||(Function.prototype.bind=function(a){var b=this,f=Array.prototype.slice.call(arguments);a=f.shift();return function(){return b.apply(a,f.concat(Array.prototype.slice.call(arguments)))}});var m=/:([\w\d]+)/g,n=/\/\*(?!\*)/,p=/\*{2}/,l=/\/*$/,c=function(){this._routes=[];this._befores=[];this._errors={_:function(a,b,f){console&&console.warn&&console.warn("Router.js : "+f)},_404:function(a,b){console&&console.warn&&console.warn("404! Unmatched route for url "+
b)},_500:function(a,b){if(console&&console.error)console.error("500! Internal error route for url "+b);else throw Error("500");}};this._paused=!1;g.onhashchange=function(a){this._paused||this._route(this._extractFragment(g.location.href));return!0}.bind(this)};c.prototype._extractFragment=function(a){var b=a.indexOf("#");return 0<=b?a.substring(b):"#/"};c.prototype._throwsRouteError=function(a,b,f){if(this._errors["_"+a]instanceof Function)this._errors["_"+a](b,f,a);else this._errors._(b,f,a);return!1};
c.prototype._buildRequestObject=function(a,b,f){if(!a)throw Error("Unable to compile request object");var d={};d.href=a;b&&(d.params=b);b=a.split("?");if(2==b.length){a=null;b=b[1].split("&");d.query={};for(var c=0,e=b.length;c<e;c++)a=b[c].split("="),d.query[decodeURI(a[0])]=decodeURI(a[1]);d.queryString=d.query}f&&0<f.length&&(d.splats=f);return d};c.prototype._followRoute=function(a,b,f){var d=f.splice(0,1),d=this._routes[d],c=b.match(d.path),e={},e={},h=[];if(!d)return this._throwsRouteError(500,
Error("Internal error"),a);for(var k=0,g=d.paramNames.length;k<g;k++)e[d.paramNames[k]]=c[k+1];k+=1;if(c&&k<c.length)for(;k<c.length;k++)h.push(c[k]);b=0==f.length?null:function(b,f,c,d){return function(d,e){if(d)return this._throwsRouteError(e||500,d,a);this._followRoute(b,f,c)}.bind(this)}.call(this,a,b,f);e=this._buildRequestObject(a,e,h);d.routeAction(e,b)};c.prototype._routeBefores=function(a,b,c,d,g){var e;if(0<a.length){var h=a.splice(0,1),h=h[0];e=function(b,e){if(b)return this._throwsRouteError(e||
500,b,c);this._routeBefores(a,h,c,d,g)}.bind(this)}else e=function(a,b){if(a)return this._throwsRouteError(b||500,a,c);this._followRoute(c,d,g)}.bind(this);b(this._buildRequestObject(c),e)};c.prototype._route=function(a){var b="",c=this._befores.slice(),d=[],g,e=a;if(0==e.length)return!0;e=e.replace(l,"");g=e.split("?")[0].replace(l,"");for(var h in this._routes)this._routes.hasOwnProperty(h)&&(b=this._routes[h],b.path.test(g)&&d.push(h));if(0<d.length)0<c.length?(b=c.splice(0,1),b=b[0],this._routeBefores(c,
b,a,e,d)):this._followRoute(a,e,d);else return this._throwsRouteError(404,null,a)};c.prototype.pause=function(){this._paused=!0};c.prototype.play=function(a){this._paused=!1;("undefined"==typeof a?0:a)&&this._route(this._extractFragment(g.location.href))};c.prototype.setLocation=function(a){g.history.pushState(null,"",a)};c.prototype.redirect=function(a){this.setLocation(a);this._paused||this._route(this._extractFragment(a))};c.prototype.addRoute=c.prototype.add=c.prototype.route=c.prototype.get=
function(a,b){var c,d=[];if("string"==typeof a){for(a=a.replace(l,"");null!=(c=m.exec(a));)d.push(c[1]);a=RegExp(a.replace(m,"([^/\\?]+)").replace(n,"/([^/]+)").replace(p,"(.*)")+"(?:\\?.+)?$")}this._routes.push({path:a,paramNames:d,routeAction:b});return this};c.prototype.before=function(a){this._befores.push(a);return this};c.prototype.errors=function(a,b){if(isNaN(a))throw Error("Invalid code for routes error handling");if(!(b instanceof Function))throw Error("Invalid callback for routes error handling");
this._errors["_"+a]=b;return this};c.prototype.run=function(a){a||(a=this._extractFragment(g.location.href));a=0==a.indexOf("#")?a:"#"+a;this.redirect(a)};g.Router=c})(window);
