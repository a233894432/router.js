(function(e,t){var n=function(t){function n(e,t){for(var n=decodeURI(e),n=s[t?"strict":"loose"].exec(n),i={attr:{},param:{},seg:{}},a=14;a--;)i.attr[r[a]]=n[a]||"";i.param.query={};i.param.fragment={};i.attr.query.replace(o,function(e,t,n){t&&(i.param.query[t]=n)});i.attr.fragment.replace(u,function(e,t,n){t&&(i.param.fragment[t]=n)});i.seg.path=i.attr.path.replace(/^\/+|\/+$/g,"").split("/");i.seg.fragment=i.attr.fragment.replace(/^\/+|\/+$/g,"").split("/");i.attr.base=i.attr.host?i.attr.protocol+"://"+i.attr.host+(i.attr.port?":"+i.attr.port:""):"";return i}var r="source,protocol,authority,userInfo,user,password,host,port,relative,path,directory,file,query,fragment".split(","),i={anchor:"fragment"},s={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},o=/(?:^|&|;)([^&=;]*)=?([^&;]*)/g,u=/(?:^|&|;)([^&=;]*)=?([^&;]*)/g;return function(r,s){1===arguments.length&&!0===r&&(s=!0,r=t);r=r||e.location.toString();return{data:n(r,s||!1),attr:function(e){e=i[e]||e;return e!==t?this.data.attr[e]:this.data.attr},param:function(e){return e!==t?this.data.param.query[e]:this.data.param.query},fparam:function(e){return e!==t?this.data.param.fragment[e]:this.data.param.fragment},segment:function(e){if(e===t)return this.data.seg.path;e=e<0?this.data.seg.path.length+e:e-1;return this.data.seg.path[e]},fsegment:function(e){if(e===t)return this.data.seg.fragment;e=e<0?this.data.seg.fragment.length+e:e-1;return this.data.seg.fragment[e]}}}}();if(!Function.prototype["bind"]){Function.prototype["bind"]=function(e){var t=this,n=Array.prototype.slice.call(arguments),e=n.shift();return function(){return t.apply(e,n.concat(Array.prototype.slice.call(arguments)))}}}var r="([^/]+)",i=/:([\w\d]+)/g,s=/\/\*(?!\*)/,o="/[^/]+",u=/\*{2}/,a=".*",f=/\/*$/;var l=function(){this._routes=[];this._befores=[];this._errors={_:function(e,t,n){if(console&&console.warn)console.warn("Router.js : "+n)},_404:function(e,t){if(console&&console.warn)console.warn("404! Unmatched route for url "+t)},_500:function(e,t){if(console&&console.error)console.error("500! Internal error route for url "+t);else{throw new Error("500")}}};this._paused=false;e.onhashchange=function(t){if(!this._paused)this._route(n(e.location.href));return true}.bind(this)};l.prototype._throwsRouteError=function(e,t,n){if(this._errors["_"+e]instanceof Function)this._errors["_"+e](t,n,e);else{this._errors["_"](t,n,e)}return false};l.prototype._buildRequestObject=function(e,t,n){if(!e)throw new Error("Unable to compile request object");var r={};r.href="#"+e.attr("fragment");if(t)r.params=t;var i=e.attr("fragment").split("?");if(i.length==2){var s=null;var o=i[1].split("&");r.queryString={};for(var u=0,a=o.length;u<a;u++){s=o[u].split("=");r.queryString[decodeURI(s[0])]=decodeURI(s[1])}}if(n&&n.length>0){r.splats=n}return r};l.prototype._followRoute=function(e,t,n){var r=n.splice(0,1),i=this._routes[r],s=t.match(i.path),o={},u={},a=[];if(!i){return this._throwsRouteError(500,new Error("Internal error"),e.attr("fragment"))}for(var f=0,l=i.paramNames.length;f<l;f++){u[i.paramNames[f]]=s[f+1]}f=f+1;if(s&&f<s.length){for(var c=f;c<s.length;c++){a.push(s[c])}}var h=n.length==0?null:function(e,t,n,r){return function(r,i){if(r)return this._throwsRouteError(i||500,r,e.attr("fragment"));this._followRoute(e,t,n)}.bind(this)}.bind(this)(e,t,n);o=this._buildRequestObject(e,u,a);i.routeAction(o,h)};l.prototype._routeBefores=function(e,t,n,r,i){var s;if(e.length>0){var o=e.splice(0,1);o=o[0];s=function(t,s){if(t)return this._throwsRouteError(s||500,t,n.attr("fragment"));this._routeBefores(e,o,n,r,i)}.bind(this)}else{s=function(e,t){if(e)return this._throwsRouteError(t||500,e,n.attr("fragment"));this._followRoute(n,r,i)}.bind(this)}t(this._buildRequestObject(n),s)};l.prototype._route=function(e){var t="",n=this._befores.slice(),r=[],i;var s=e.attr("fragment");if(!s)return true;s="#"+s.replace(f,"");i=s.split("?")[0].replace(f,"");for(var o in this._routes){if(this._routes.hasOwnProperty(o)){t=this._routes[o];if(t.path.test(i)){r.push(o)}}}if(r.length>0){if(n.length>0){var u=n.splice(0,1);u=u[0];this._routeBefores(n,u,e,s,r)}else{this._followRoute(e,s,r)}}else{return this._throwsRouteError(404,null,e.attr("fragment"))}};l.prototype.pause=function(){this._paused=true};l.prototype.play=function(t){t="undefined"==typeof t?false:t;this._paused=false;if(t){this._route(n(e.location.href))}};l.prototype.setLocation=function(t){e.history.pushState(null,"",t)};l.prototype.redirect=function(e){this.setLocation(e);if(!this._paused)this._route(n(e))};l.prototype.addRoute=function(e,t){var n,l=[];if("string"==typeof e){e=e.replace(f,"");while((n=i.exec(e))!=null){l.push(n[1])}e=new RegExp(e.replace(i,r).replace(s,o).replace(u,a)+"$")}this._routes.push({path:e,paramNames:l,routeAction:t});return this};l.prototype.before=function(e){this._befores.push(e);return this};l.prototype.errors=function(e,t){if(isNaN(e)){throw new Error("Invalid code for routes error handling")}if(!(t instanceof Function)){throw new Error("Invalid callback for routes error handling")}e="_"+e;this._errors[e]=t;return this};l.prototype.run=function(t){if(!t){t=n(e.location.href).attr("fragment")}t=t.indexOf("#")==0?t:"#"+t;this.redirect(t)};e.Router=l})(window)