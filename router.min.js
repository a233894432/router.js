(function(f){var k=function(b){function a(b,a){for(var j=decodeURI(b),j=g[a?"strict":"loose"].exec(j),c={attr:{},param:{},seg:{}},f=14;f--;)c.attr[d[f]]=j[f]||"";c.param.query={};c.param.fragment={};c.attr.query.replace(i,function(b,a,j){a&&(c.param.query[a]=j)});c.attr.fragment.replace(e,function(b,a,j){a&&(c.param.fragment[a]=j)});c.seg.path=c.attr.path.replace(/^\/+|\/+$/g,"").split("/");c.seg.fragment=c.attr.fragment.replace(/^\/+|\/+$/g,"").split("/");c.attr.base=c.attr.host?c.attr.protocol+
"://"+c.attr.host+(c.attr.port?":"+c.attr.port:""):"";return c}var d="source protocol authority userInfo user password host port relative path directory file query fragment".split(" "),c={anchor:"fragment"},g={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},
i=/(?:^|&|;)([^&=;]*)=?([^&;]*)/g,e=/(?:^|&|;)([^&=;]*)=?([^&;]*)/g;return function(d,g){1===arguments.length&&!0===d&&(g=!0,d=b);d=d||f.location.toString();return{data:a(d,g||!1),attr:function(a){a=c[a]||a;return a!==b?this.data.attr[a]:this.data.attr},param:function(a){return a!==b?this.data.param.query[a]:this.data.param.query},fparam:function(a){return a!==b?this.data.param.fragment[a]:this.data.param.fragment},segment:function(a){if(a===b)return this.data.seg.path;a=0>a?this.data.seg.path.length+
a:a-1;return this.data.seg.path[a]},fsegment:function(a){if(a===b)return this.data.seg.fragment;a=0>a?this.data.seg.fragment.length+a:a-1;return this.data.seg.fragment[a]}}}}();Function.prototype.bind||(Function.prototype.bind=function(b){var a=this,d=Array.prototype.slice.call(arguments),b=d.shift();return function(){return a.apply(b,d.concat(Array.prototype.slice.call(arguments)))}});var l=/:([\w\d]+)/g,n=/\*/g,m=/\/*$/,e=function(){this._routes=[];this._befores=[];this._errors={_:function(b,a,
d){console&&console.warn&&console.warn("Router.js : "+d)},_404:function(b,a){console&&console.warn&&console.warn("404! Unmatched route for url "+a)},_500:function(b,a){if(console&&console.error)console.error("500! Internal error route for url "+a);else throw Error("500");}};this._paused=!1;f.onhashchange=function(){this._paused||this._route(k(f.location.href));return!0}.bind(this)};e.prototype._throwsRouteError=function(b,a,d){if(this._errors["_"+b]instanceof Function)this._errors["_"+b](a,d,b);else this._errors._(a,
d,b);return!1};e.prototype._buildRequestObject=function(b,a,d){if(!b)throw Error("Unable to compile request object");var c={};c.href="#"+b.attr("fragment");a&&(c.params=a);a=b.attr("fragment").split("?");if(2==a.length){b=null;a=a[1].split("&");c.queryString={};for(var g=0,i=a.length;g<i;g++)b=a[g].split("="),c.queryString[decodeURI(b[0])]=decodeURI(b[1])}d&&0<d.length&&(c.splats=d);return c};e.prototype._followRoute=function(b,a,d){var c=this._routes[d.splice(0,1)],g=a.match(c.path),i={},i={},e=
[];if(!c)return this._throwsRouteError(500,Error("Internal error"),b.attr("fragment"));for(var h=0,f=c.paramNames.length;h<f;h++)i[c.paramNames[h]]=g[h+1];h+=1;if(h<g.length)for(;h<g.length;h++)e.push(g[h]);a=0==d.length?null:function(a,b,c){return function(d,g){if(d)return this._throwsRouteError(g||500,d,a.attr("fragment"));this._followRoute(a,b,c)}.bind(this)}.call(this,b,a,d);i=this._buildRequestObject(b,i,e);c.routeAction(i,a)};e.prototype._routeBefores=function(b,a,d,c,g){var e;if(0<b.length){var f=
b.splice(0,1),f=f[0];e=function(a,e){if(a)return this._throwsRouteError(e||500,a,d.attr("fragment"));this._routeBefores(b,f,d,c,g)}.bind(this)}else e=function(a,b){if(a)return this._throwsRouteError(b||500,a,d.attr("fragment"));this._followRoute(d,c,g)}.bind(this);a(this._buildRequestObject(d),e)};e.prototype._route=function(b){var a="",d=this._befores.slice(),c=[],e=b.attr("fragment");if(!e)return!0;var e="#"+e.split("?")[0].replace(m,""),f;for(f in this._routes)this._routes.hasOwnProperty(f)&&(a=
this._routes[f],a.path.test(e)&&c.push(f));if(0<c.length)0<d.length?(a=d.splice(0,1),a=a[0],this._routeBefores(d,a,b,e,c)):this._followRoute(b,e,c);else return this._throwsRouteError(404,null,b.attr("fragment"))};e.prototype.pause=function(){this._paused=!0};e.prototype.play=function(b){this._paused=!1;("undefined"==typeof b?0:b)&&this._route(k(f.location.href))};e.prototype.setLocation=function(b){f.history.pushState(null,"",b)};e.prototype.redirect=function(b){this.setLocation(b);this._paused||
this._route(k(f.location.href))};e.prototype.addRoute=function(b,a){var d,c=[];if("string"==typeof b){for(b=b.replace(m,"");null!=(d=l.exec(b));)c.push(d[1]);b=RegExp(b.replace(l,"([^/]+)").replace(n,"[^/]+")+"$")}this._routes.push({path:b,paramNames:c,routeAction:a});return this};e.prototype.before=function(b){this._befores.push(b);return this};e.prototype.errors=function(b,a){if(isNaN(b))throw Error("Invalid code for routes error handling");if(!(a instanceof Function))throw Error("Invalid callback for routes error handling");
this._errors["_"+b]=a;return this};e.prototype.run=function(b){b||(b=k(f.location.href).attr("fragment"));b=0==b.indexOf("#")?b:"#"+b;this.redirect(b)};f.Router=e})(window);