(function(g){var k=function(b){function a(b,a){for(var j=decodeURI(b),j=h[a?"strict":"loose"].exec(j),c={attr:{},param:{},seg:{}},g=14;g--;)c.attr[d[g]]=j[g]||"";c.param.query={};c.param.fragment={};c.attr.query.replace(e,function(b,a,j){a&&(c.param.query[a]=j)});c.attr.fragment.replace(f,function(b,a,j){a&&(c.param.fragment[a]=j)});c.seg.path=c.attr.path.replace(/^\/+|\/+$/g,"").split("/");c.seg.fragment=c.attr.fragment.replace(/^\/+|\/+$/g,"").split("/");c.attr.base=c.attr.host?c.attr.protocol+
"://"+c.attr.host+(c.attr.port?":"+c.attr.port:""):"";return c}var d="source protocol authority userInfo user password host port relative path directory file query fragment".split(" "),c={anchor:"fragment"},h={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},
e=/(?:^|&|;)([^&=;]*)=?([^&;]*)/g,f=/(?:^|&|;)([^&=;]*)=?([^&;]*)/g;return function(d,e){1===arguments.length&&!0===d&&(e=!0,d=b);d=d||g.location.toString();return{data:a(d,e||!1),attr:function(a){a=c[a]||a;return a!==b?this.data.attr[a]:this.data.attr},param:function(a){return a!==b?this.data.param.query[a]:this.data.param.query},fparam:function(a){return a!==b?this.data.param.fragment[a]:this.data.param.fragment},segment:function(a){if(a===b)return this.data.seg.path;a=0>a?this.data.seg.path.length+
a:a-1;return this.data.seg.path[a]},fsegment:function(a){if(a===b)return this.data.seg.fragment;a=0>a?this.data.seg.fragment.length+a:a-1;return this.data.seg.fragment[a]}}}}();Function.prototype.bind||(Function.prototype.bind=function(b){var a=this,d=Array.prototype.slice.call(arguments),b=d.shift();return function(){return a.apply(b,d.concat(Array.prototype.slice.call(arguments)))}});var m=/:([\w\d]+)/g,n=/\*/g,l=/\/*$/,f=function(){this._routes=[];this._befores=[];this._errors={_:function(b,a,
d){console&&console.warn&&console.warn("Router.js : "+d)},_404:function(b,a){console&&console.warn&&console.warn("404! Unmatched route for url "+a)},_500:function(b,a){if(console&&console.error)console.error("500! Internal error route for url "+a);else throw Error("500");}};this._paused=!1;g.onhashchange=function(){this._paused||this._route(k(g.location.href));return!0}.bind(this)};f.prototype._throwsRouteError=function(b,a,d){if(this._errors["_"+b]instanceof Function)this._errors["_"+b](a,d,b);else this._errors._(a,
d,b);return!1};f.prototype._buildRequestObject=function(b,a,d){if(!b)throw Error("Unable to compile request object");var c={};c.href="#"+b.attr("fragment");a&&(c.params=a);a=b.attr("fragment").split("?");if(2==a.length){b=null;a=a[1].split("&");c.queryString={};for(var h=0,e=a.length;h<e;h++)b=a[h].split("="),c.queryString[decodeURI(b[0])]=decodeURI(b[1])}d&&0<d.length&&(c.splats=d);return c};f.prototype._followRoute=function(b,a,d){var c=this._routes[d.splice(0,1)],h=a.match(c.path),e={},e={},f=
[];if(!c)return this._throwsRouteError(500,Error("Internal error"),b.attr("fragment"));for(var i=0,g=c.paramNames.length;i<g;i++)e[c.paramNames[i]]=h[i+1];i+=1;if(h&&i<h.length)for(;i<h.length;i++)f.push(h[i]);a=0==d.length?null:function(a,b,c){return function(d,e){if(d)return this._throwsRouteError(e||500,d,a.attr("fragment"));this._followRoute(a,b,c)}.bind(this)}.call(this,b,a,d);e=this._buildRequestObject(b,e,f);c.routeAction(e,a)};f.prototype._routeBefores=function(b,a,d,c,f){var e;if(0<b.length){var g=
b.splice(0,1),g=g[0];e=function(a,e){if(a)return this._throwsRouteError(e||500,a,d.attr("fragment"));this._routeBefores(b,g,d,c,f)}.bind(this)}else e=function(a,b){if(a)return this._throwsRouteError(b||500,a,d.attr("fragment"));this._followRoute(d,c,f)}.bind(this);a(this._buildRequestObject(d),e)};f.prototype._route=function(b){var a="",d=this._befores.slice(),c=[],f,e=b.attr("fragment");if(!e)return!0;e="#"+e.replace(l,"");f=e.split("?")[0].replace(l,"");for(var g in this._routes)this._routes.hasOwnProperty(g)&&
(a=this._routes[g],a.path.test(f)&&c.push(g));if(0<c.length)0<d.length?(a=d.splice(0,1),a=a[0],this._routeBefores(d,a,b,e,c)):this._followRoute(b,e,c);else return this._throwsRouteError(404,null,b.attr("fragment"))};f.prototype.pause=function(){this._paused=!0};f.prototype.play=function(b){this._paused=!1;("undefined"==typeof b?0:b)&&this._route(k(g.location.href))};f.prototype.setLocation=function(b){g.history.pushState(null,"",b)};f.prototype.redirect=function(b){this.setLocation(b);this._paused||
this._route(k(b))};f.prototype.addRoute=function(b,a){var d,c=[];if("string"==typeof b){for(b=b.replace(l,"");null!=(d=m.exec(b));)c.push(d[1]);b=RegExp(b.replace(m,"([^/]+)").replace(n,"[^/]+")+"$")}this._routes.push({path:b,paramNames:c,routeAction:a});return this};f.prototype.before=function(b){this._befores.push(b);return this};f.prototype.errors=function(b,a){if(isNaN(b))throw Error("Invalid code for routes error handling");if(!(a instanceof Function))throw Error("Invalid callback for routes error handling");
this._errors["_"+b]=a;return this};f.prototype.run=function(b){b||(b=k(g.location.href).attr("fragment"));b=0==b.indexOf("#")?b:"#"+b;this.redirect(b)};g.Router=f})(window);