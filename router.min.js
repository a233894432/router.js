/*
 Router.js
 @version 0.8.1
 @author: Fabrizio Ruggeri
 website: http://ramielcreations.com/projects/router-js/
 @license GPL-v2
*/
(function(m,l){"undefined"!=typeof module?module.exports=l():"function"==typeof define&&"object"==typeof define.amd?define(l):this[m]=l()})("Router",function(){function m(){for(var a=1;a<arguments.length;a++)for(var b in arguments[a])arguments[a].hasOwnProperty(b)&&(arguments[0][b]=arguments[a][b]);return arguments[0]}Function.prototype.bind||(Function.prototype.bind=function(a){var b=this,d=Array.prototype.slice.call(arguments);a=d.shift();return function(){return b.apply(a,d.concat(Array.prototype.slice.call(arguments)))}});
var l=/:([\w\d]+)/g,q=/\/\*(?!\*)/,r=/\*{2}/,n=/\/*$/,p=function(a){this.href=a;this.params;this.query;this.splat};p.prototype.get=function(a,b){return this.params&&void 0!==this.params[a]?this.params[a]:this.query&&void 0!==this.query[a]?this.query[a]:void 0!==b?b:void 0};var c=function(a){this._options=m({ignorecase:!0},a);this._routes=[];this._befores=[];this._errors={_:function(a,d,e){console&&console.warn&&console.warn("Router.js : "+e)},_404:function(a,d){console&&console.warn&&console.warn("404! Unmatched route for url "+
d)},_500:function(a,d){if(console&&console.error)console.error("500! Internal error route for url "+d);else throw Error("500");}};this._paused=!1;window.onhashchange=function(a){this._paused||this._route(this._extractFragment(window.location.href));return!0}.bind(this)};c.prototype._extractFragment=function(a){var b=a.indexOf("#");return 0<=b?a.substring(b):"#/"};c.prototype._throwsRouteError=function(a,b,d){if(this._errors["_"+a]instanceof Function)this._errors["_"+a](b,d,a);else this._errors._(b,
d,a);return!1};c.prototype._buildRequestObject=function(a,b,d){if(!a)throw Error("Unable to compile request object");var e=new p(a);b&&(e.params=b);b=a.split("?");if(2==b.length){a=null;b=b[1].split("&");e.query={};for(var g=0,c=b.length;g<c;g++)a=b[g].split("="),e.query[decodeURI(a[0])]=decodeURI(a[1].replace(/\+/g,"%20"));e.query}d&&0<d.length&&(e.splats=d);return e};c.prototype._followRoute=function(a,b,d){var e=d.splice(0,1),e=this._routes[e],c=b.match(e.path),f={},k=[];if(!e)return this._throwsRouteError(500,
Error("Internal error"),a);for(var h=0,l=e.paramNames.length;h<l;h++)f[e.paramNames[h]]=c[h+1];h+=1;if(c&&h<c.length)for(;h<c.length;h++)k.push(c[h]);b=0==d.length?null:function(b,d,e,c){return function(c,h){if(c)return this._throwsRouteError(h||500,c,a);this._followRoute(b,d,e)}.bind(this)}.call(this,a,b,d);d=this._buildRequestObject(a,f,k);e.routeAction(d,b)};c.prototype._routeBefores=function(a,b,d,c,g){var f;if(0<a.length){var k=a.splice(0,1),k=k[0];f=function(b,f){if(b)return this._throwsRouteError(f||
500,b,d);this._routeBefores(a,k,d,c,g)}.bind(this)}else f=function(a,b){if(a)return this._throwsRouteError(b||500,a,d);this._followRoute(d,c,g)}.bind(this);b(this._buildRequestObject(d),f)};c.prototype._route=function(a){var b="",d=this._befores.slice(),c=[],g,f=a;if(0==f.length)return!0;f=f.replace(n,"");g=f.split("?")[0].replace(n,"");for(var k in this._routes)this._routes.hasOwnProperty(k)&&(b=this._routes[k],b.path.test(g)&&c.push(k));if(0<c.length)0<d.length?(b=d.splice(0,1),b=b[0],this._routeBefores(d,
b,a,f,c)):this._followRoute(a,f,c);else return this._throwsRouteError(404,null,a)};c.prototype.play=function(a){this._paused=!1;("undefined"==typeof a?0:a)&&this._route(this._extractFragment(window.location.href));return this};c.prototype.setLocation=function(a){window.history.pushState(null,"",a);return this};c.prototype.redirect=function(a){this.setLocation(a);this._paused||this._route(this._extractFragment(a));return this};c.prototype.addRoute=c.prototype.add=c.prototype.route=c.prototype.get=
function(a,b){var c,e=this._options.ignorecase?"i":"",g=[];if("string"==typeof a){for(a=a.replace(n,"");null!=(c=l.exec(a));)g.push(c[1]);a=RegExp(a.replace(l,"([^/\\?]+)").replace(q,"/([^/\\?]+)").replace(r,"(.*?)\\??")+"(?:\\?.+)?$",e)}this._routes.push({path:a,paramNames:g,routeAction:b});return this};c.prototype.before=function(a){this._befores.push(a);return this};c.prototype.errors=function(a,b){if(isNaN(a))throw Error("Invalid code for routes error handling");if(!(b instanceof Function))throw Error("Invalid callback for routes error handling");
this._errors["_"+a]=b;return this};c.prototype.run=function(a){a||(a=this._extractFragment(window.location.href));a=0==a.indexOf("#")?a:"#"+a;this.redirect(a);return this};return c});
